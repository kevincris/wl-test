{"version":3,"sources":["./src/app/embedded/wizard/embedded-wizard.component.html","./src/app/embedded/wizard/embedded-wizard.component.scss","./src/app/embedded/embedded.module.ts","./src/app/embedded/wizard/embedded-wizard.component.ts","./src/app/embedded/embedded-routing.module.ts"],"names":[],"mappings":"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","file":"embedded-embedded-module.js","sourcesContent":["export default \"<div class=\\\"wizard-container\\\">\\n    <a [routerLink]=\\\"['/']\\\">\\n        <img class=\\\"logo\\\" src=\\\"/img/brand/logo-white-horizontal.svg\\\" />\\n    </a>\\n    <div id=\\\"bas-widget-container\\\" [style.visibility]=\\\"!running\\\"></div>\\n</div>\\n\";","export default \".wizard-container {\\n  display: flex;\\n  align-items: center;\\n  flex-direction: column;\\n  background-color: #3983ec;\\n  height: 100%;\\n}\\n\\n.logo {\\n  width: 194px;\\n  margin: 1.5rem 1.5rem auto;\\n  display: block;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2VtYmVkZGVkLXdpemFyZC5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGFBQUE7RUFDQSxtQkFBQTtFQUNBLHNCQUFBO0VBQ0EseUJBQUE7RUFDQSxZQUFBO0FBQ0Y7O0FBRUE7RUFDRSxZQUFBO0VBQ0EsMEJBQUE7RUFDQSxjQUFBO0FBQ0YiLCJmaWxlIjoiZW1iZWRkZWQtd2l6YXJkLmNvbXBvbmVudC5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLndpemFyZC1jb250YWluZXIge1xuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjMzk4M2VjO1xuICBoZWlnaHQ6IDEwMCU7XG59XG5cbi5sb2dvIHtcbiAgd2lkdGg6IDE5NHB4O1xuICBtYXJnaW46IDEuNXJlbSAxLjVyZW0gYXV0bztcbiAgZGlzcGxheTogYmxvY2s7XG59XG4iXX0= */\";","import { NgModule } from '@angular/core'\nimport { CommonModule } from '../common/common.module'\nimport { KycWizardModule } from '../kyc-wizard/kyc-wizard.module'\nimport { EmbeddedRoutingModule } from './embedded-routing.module'\nimport { EmbeddedWizardComponent } from './wizard/embedded-wizard.component'\n\n@NgModule({\n    declarations: [EmbeddedWizardComponent],\n    imports: [CommonModule, EmbeddedRoutingModule, KycWizardModule],\n})\nexport class EmbeddedModule {}\n","import { HttpClient } from '@angular/common/http'\nimport { AfterViewInit, Component, OnDestroy, OnInit } from '@angular/core'\nimport { TranslateService } from '@ngx-translate/core'\nimport { Base64 } from 'js-base64'\nimport { Subscription } from 'rxjs'\nimport { flatMap } from 'rxjs/operators'\nimport { Verification } from 'src/app/common/api-interfaces'\nimport { BasisIdService } from 'src/app/common/services/basis-id.service'\nimport { ConfirmationService } from 'src/app/common/services/confirmation.service'\nimport { IntercomService } from 'src/app/common/services/intercom.service'\nimport { SessionService } from 'src/app/common/services/session.service'\n\n@Component({\n    selector: 'embedded-wizard',\n    templateUrl: 'embedded-wizard.component.html',\n    styleUrls: ['embedded-wizard.component.scss'],\n})\nexport class EmbeddedWizardComponent implements AfterViewInit, OnInit, OnDestroy {\n    public verificationId: string\n    public token: string\n    public running = false\n\n    private subscriptions = new Subscription()\n\n    constructor(\n        private basisId: BasisIdService,\n        private confirmation: ConfirmationService,\n        private http: HttpClient,\n        private intercom: IntercomService,\n        private session: SessionService,\n        public translate: TranslateService\n    ) {}\n\n    public ngOnInit(): void {\n        if (!!this.session.user) {\n            this.session.logout()\n        }\n    }\n\n    public ngAfterViewInit(): void {\n        window.addEventListener('message', event => {\n            if (!event.data.token) {\n                return\n            }\n            if (event.data.type === 'aerapass.wizard.token') {\n                const payload = this.parseToken(event.data.token)\n                this.token = event.data.token\n                this.verificationId = payload.verificationId\n                this.initBasisId(payload.userID)\n            }\n        })\n        window.parent.postMessage({ type: 'aerapass.wizard.ready' }, '*')\n        this.intercom.shutdown()\n        this.subscriptions.add(\n            this.basisId.onSuccess\n                .pipe(\n                    flatMap(() =>\n                        this.http.post<void>(\n                            `/verifications/${this.verificationId}/set-completed`,\n                            {\n                                completed: true,\n                            },\n                            {\n                                headers: {\n                                    Authorization: `Bearer ${this.token}`,\n                                },\n                            }\n                        )\n                    )\n                )\n                .subscribe(() => {\n                    window.parent.postMessage({ type: 'aerapass.wizard.complete', status: 'complete' }, '*')\n                })\n        )\n        this.subscriptions.add(\n            this.basisId.onError\n                .pipe(\n                    flatMap(() =>\n                        this.confirmation.show({\n                            type: 'warning',\n                            text: this.translate.instant('common.there-was-a-problem-in-verification'),\n                            showCancel: false,\n                            confirmText: this.translate.instant('common.relaod-page'),\n                        })\n                    )\n                )\n                .subscribe(() => {\n                    location.reload()\n                })\n        )\n    }\n\n    public ngOnDestroy(): void {\n        this.subscriptions.unsubscribe()\n    }\n\n    private initBasisId(userId: string): void {\n        this.basisId\n            .init()\n            .pipe(\n                flatMap(() =>\n                    this.http.post<Verification>(\n                        `/verifications`,\n                        { user: { id: userId } },\n                        {\n                            headers: {\n                                Authorization: `Bearer ${this.token}`,\n                            },\n                        }\n                    )\n                )\n            )\n            .subscribe(verification => {\n                this.running = true\n                this.basisId.loadWidget({\n                    key: verification.user.type === 'business' ? window.BASIS_ID_KYB_KEY! : window.BASIS_ID_KYC_KEY!,\n                    formToken: verification.formToken,\n                })\n            })\n    }\n\n    private parseToken(token: string): any {\n        return JSON.parse(Base64.decode(token.split('.')[1]))\n    }\n}\n","import { NgModule } from '@angular/core'\nimport { RouterModule } from '@angular/router'\nimport { EmbeddedWizardComponent } from './wizard/embedded-wizard.component'\n\nconst routes = [\n    {\n        path: 'wizard',\n        component: EmbeddedWizardComponent,\n    },\n]\n@NgModule({\n    imports: [RouterModule.forChild(routes)],\n    exports: [RouterModule],\n})\nexport class EmbeddedRoutingModule {}\n"],"sourceRoot":"webpack:///"}